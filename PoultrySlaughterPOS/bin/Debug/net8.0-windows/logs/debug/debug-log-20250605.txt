[2025-06-05 19:01:44.856 +03:00 INF] : === Poultry Slaughter POS Application Starting ===
[2025-06-05 19:01:44.950 +03:00 INF] : Startup initiated with complete customer management integration
[2025-06-05 19:01:45.788 +03:00 INF] : Database configuration - UseExplicitTransactions: true, EnableRetryOnFailure: false
[2025-06-05 19:01:45.865 +03:00 INF] : Service configuration completed successfully with 115 services registered (complete customer management integration)
[2025-06-05 19:01:45.926 +03:00 INF] Microsoft.Hosting.Lifetime: Application started. Press Ctrl+C to shut down.
[2025-06-05 19:01:45.941 +03:00 INF] Microsoft.Hosting.Lifetime: Hosting environment: Production
[2025-06-05 19:01:45.941 +03:00 INF] Microsoft.Hosting.Lifetime: Content root path: C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\bin\Debug\net8.0-windows
[2025-06-05 19:01:45.941 +03:00 INF] : Application host built and started successfully with complete customer management integration
[2025-06-05 19:01:46.064 +03:00 INF] : Database initialization started
[2025-06-05 19:01:46.066 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Starting database initialization for SQL Server...
[2025-06-05 19:01:47.018 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Verifying SQL Server instance with connection: Server=.\posserver;Database=chicken;Trusted_Connection=True;MultipleActiveResultSets=true;TrustServerCertificate=True
[2025-06-05 19:01:47.572 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Testing SQL Server connection...
[2025-06-05 19:01:47.691 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: SQL Server connection successful.
[2025-06-05 19:01:47.949 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database 'chicken' created/verified successfully.
[2025-06-05 19:01:48.438 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database schema verification completed:
[2025-06-05 19:01:48.438 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - TRUCKS: 3 records
[2025-06-05 19:01:48.438 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - CUSTOMERS: 4 records
[2025-06-05 19:01:48.438 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - TRUCK_LOADS: 6 records
[2025-06-05 19:01:48.438 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - INVOICES: 40 records
[2025-06-05 19:01:48.438 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - PAYMENTS: 8 records
[2025-06-05 19:01:48.438 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - DAILY_RECONCILIATION: 0 records
[2025-06-05 19:01:48.438 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - AUDIT_LOGS: 103 records
[2025-06-05 19:01:48.438 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database initialization completed successfully.
[2025-06-05 19:01:48.439 +03:00 INF] : Database initialization completed successfully
[2025-06-05 19:01:48.923 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:01:49.455 +03:00 WRN] Microsoft.EntityFrameworkCore.Query: The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
[2025-06-05 19:01:49.469 +03:00 INF] PoultrySlaughterPOS.MainWindow: MainWindow initialized successfully with complete customer management support
[2025-06-05 19:01:49.726 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:01:50.098 +03:00 ERR] Microsoft.EntityFrameworkCore.Query: An exception occurred while iterating over the results of a query for context type 'PoultrySlaughterPOS.Data.PoultryDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
[2025-06-05 19:01:50.252 +03:00 ERR] PoultrySlaughterPOS.Services.Repositories.CustomerRepository: Error retrieving debt summary
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetDebtSummaryAsync(CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 177
[2025-06-05 19:01:50.426 +03:00 INF] PoultrySlaughterPOS.MainWindow: MainWindow loaded successfully
[2025-06-05 19:01:50.442 +03:00 INF] : Main window created and displayed successfully
[2025-06-05 19:01:50.442 +03:00 INF] : === Poultry Slaughter POS Application Started Successfully ===
[2025-06-05 19:01:50.452 +03:00 INF] PoultrySlaughterPOS.MainWindow: Dashboard statistics loaded successfully - Trucks: 3, Customers: 4, Invoices: 1, Debt: ¤100.25
[2025-06-05 19:01:50.499 +03:00 ERR] PoultrySlaughterPOS.MainWindow: Error loading dashboard statistics
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetDebtSummaryAsync(CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 177
   at PoultrySlaughterPOS.MainWindow.LoadDashboardStatisticsAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\MainWindow.xaml.cs:line 527
[2025-06-05 19:01:50.503 +03:00 WRN] PoultrySlaughterPOS.MainWindow: Status message (Error): خطأ في تحميل إحصائيات النظام
[2025-06-05 19:01:50.504 +03:00 INF] PoultrySlaughterPOS.MainWindow: Initial dashboard loaded successfully
[2025-06-05 19:02:14.717 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:02:14.756 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized with invoice search and edit capabilities
[2025-06-05 19:02:14.757 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized with invoice search and edit capabilities
[2025-06-05 19:02:14.921 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialized successfully with search and edit capabilities
[2025-06-05 19:02:14.921 +03:00 INF] PoultrySlaughterPOS.Views.POSView: POSView ViewModel set successfully
[2025-06-05 19:02:14.921 +03:00 INF] PoultrySlaughterPOS.MainWindow: POS view created and configured successfully
[2025-06-05 19:02:14.923 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Initializing enhanced POSView with comprehensive data loading and search capabilities
[2025-06-05 19:02:15.302 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Initializing enhanced POSView with comprehensive data loading and search capabilities
[2025-06-05 19:02:15.315 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 4 active customers
[2025-06-05 19:02:15.451 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 3 active trucks
[2025-06-05 19:02:15.566 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 4 active customers
[2025-06-05 19:02:15.574 +03:00 INF] PoultrySlaughterPOS.Repositories.InvoiceRepository: Generated optimized invoice number: 202506050002
[2025-06-05 19:02:15.679 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Real invoice number generated and set: 202506050002
[2025-06-05 19:02:15.680 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized successfully with search and edit capabilities
[2025-06-05 19:02:15.684 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialization completed successfully
[2025-06-05 19:02:15.684 +03:00 INF] PoultrySlaughterPOS.Views.POSView: POSView async initialization completed successfully
[2025-06-05 19:02:15.685 +03:00 INF] PoultrySlaughterPOS.MainWindow: Successfully navigated to POSSales
[2025-06-05 19:02:15.695 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 3 active trucks
[2025-06-05 19:02:15.808 +03:00 INF] PoultrySlaughterPOS.Repositories.InvoiceRepository: Generated optimized invoice number: 202506050002
[2025-06-05 19:02:15.812 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Real invoice number generated and set: 202506050002
[2025-06-05 19:02:15.813 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized successfully with search and edit capabilities
[2025-06-05 19:02:15.813 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialization completed successfully
[2025-06-05 19:02:15.814 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Applying emergency TextBox visibility fix
[2025-06-05 19:02:15.822 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Emergency TextBox visibility fix applied successfully
[2025-06-05 19:02:15.822 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Applying emergency TextBox visibility fix
[2025-06-05 19:02:15.827 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Emergency TextBox visibility fix applied successfully
[2025-06-05 19:08:37.454 +03:00 INF] : === Poultry Slaughter POS Application Starting ===
[2025-06-05 19:08:37.556 +03:00 INF] : Startup initiated with complete customer management integration
[2025-06-05 19:08:37.888 +03:00 INF] : Database configuration - UseExplicitTransactions: true, EnableRetryOnFailure: false
[2025-06-05 19:08:38.008 +03:00 INF] : Service configuration completed successfully with 115 services registered (complete customer management integration)
[2025-06-05 19:08:38.119 +03:00 INF] Microsoft.Hosting.Lifetime: Application started. Press Ctrl+C to shut down.
[2025-06-05 19:08:38.128 +03:00 INF] Microsoft.Hosting.Lifetime: Hosting environment: Production
[2025-06-05 19:08:38.128 +03:00 INF] Microsoft.Hosting.Lifetime: Content root path: C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\bin\Debug\net8.0-windows
[2025-06-05 19:08:38.129 +03:00 INF] : Application host built and started successfully with complete customer management integration
[2025-06-05 19:08:38.218 +03:00 INF] : Database initialization started
[2025-06-05 19:08:38.222 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Starting database initialization for SQL Server...
[2025-06-05 19:08:39.853 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Verifying SQL Server instance with connection: Server=.\posserver;Database=chicken;Trusted_Connection=True;MultipleActiveResultSets=true;TrustServerCertificate=True
[2025-06-05 19:08:40.381 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Testing SQL Server connection...
[2025-06-05 19:08:40.554 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: SQL Server connection successful.
[2025-06-05 19:08:40.728 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database 'chicken' created/verified successfully.
[2025-06-05 19:08:41.173 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database schema verification completed:
[2025-06-05 19:08:41.173 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - TRUCKS: 3 records
[2025-06-05 19:08:41.173 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - CUSTOMERS: 4 records
[2025-06-05 19:08:41.173 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - TRUCK_LOADS: 6 records
[2025-06-05 19:08:41.173 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - INVOICES: 40 records
[2025-06-05 19:08:41.173 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - PAYMENTS: 8 records
[2025-06-05 19:08:41.173 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - DAILY_RECONCILIATION: 0 records
[2025-06-05 19:08:41.173 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - AUDIT_LOGS: 103 records
[2025-06-05 19:08:41.173 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database initialization completed successfully.
[2025-06-05 19:08:41.173 +03:00 INF] : Database initialization completed successfully
[2025-06-05 19:08:41.561 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:08:42.081 +03:00 WRN] Microsoft.EntityFrameworkCore.Query: The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
[2025-06-05 19:08:42.095 +03:00 INF] PoultrySlaughterPOS.MainWindow: MainWindow initialized successfully with complete customer management support
[2025-06-05 19:08:42.332 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:08:42.794 +03:00 ERR] Microsoft.EntityFrameworkCore.Query: An exception occurred while iterating over the results of a query for context type 'PoultrySlaughterPOS.Data.PoultryDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
[2025-06-05 19:08:42.932 +03:00 ERR] PoultrySlaughterPOS.Services.Repositories.CustomerRepository: Error retrieving debt summary
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetDebtSummaryAsync(CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 177
[2025-06-05 19:08:43.141 +03:00 INF] PoultrySlaughterPOS.MainWindow: MainWindow loaded successfully
[2025-06-05 19:08:43.168 +03:00 INF] : Main window created and displayed successfully
[2025-06-05 19:08:43.168 +03:00 INF] : === Poultry Slaughter POS Application Started Successfully ===
[2025-06-05 19:08:43.256 +03:00 INF] PoultrySlaughterPOS.MainWindow: Dashboard statistics loaded successfully - Trucks: 3, Customers: 4, Invoices: 1, Debt: ¤100.25
[2025-06-05 19:08:43.334 +03:00 ERR] PoultrySlaughterPOS.MainWindow: Error loading dashboard statistics
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetDebtSummaryAsync(CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 177
   at PoultrySlaughterPOS.MainWindow.LoadDashboardStatisticsAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\MainWindow.xaml.cs:line 527
[2025-06-05 19:08:43.339 +03:00 WRN] PoultrySlaughterPOS.MainWindow: Status message (Error): خطأ في تحميل إحصائيات النظام
[2025-06-05 19:08:43.339 +03:00 INF] PoultrySlaughterPOS.MainWindow: Initial dashboard loaded successfully
[2025-06-05 19:09:18.483 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:09:18.507 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized with invoice search and edit capabilities
[2025-06-05 19:09:18.508 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized with invoice search and edit capabilities
[2025-06-05 19:09:18.631 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialized successfully with search and edit capabilities
[2025-06-05 19:09:18.632 +03:00 INF] PoultrySlaughterPOS.Views.POSView: POSView ViewModel set successfully
[2025-06-05 19:09:18.632 +03:00 INF] PoultrySlaughterPOS.MainWindow: POS view created and configured successfully
[2025-06-05 19:09:18.633 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Initializing enhanced POSView with comprehensive data loading and search capabilities
[2025-06-05 19:09:18.959 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Initializing enhanced POSView with comprehensive data loading and search capabilities
[2025-06-05 19:09:18.976 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 4 active customers
[2025-06-05 19:09:19.085 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 4 active customers
[2025-06-05 19:09:19.253 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 3 active trucks
[2025-06-05 19:09:19.361 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 3 active trucks
[2025-06-05 19:09:19.372 +03:00 INF] PoultrySlaughterPOS.Repositories.InvoiceRepository: Generated optimized invoice number: 202506050002
[2025-06-05 19:09:19.444 +03:00 INF] PoultrySlaughterPOS.Repositories.InvoiceRepository: Generated optimized invoice number: 202506050002
[2025-06-05 19:09:19.445 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Real invoice number generated and set: 202506050002
[2025-06-05 19:09:19.445 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized successfully with search and edit capabilities
[2025-06-05 19:09:19.449 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialization completed successfully
[2025-06-05 19:09:19.449 +03:00 INF] PoultrySlaughterPOS.Views.POSView: POSView async initialization completed successfully
[2025-06-05 19:09:19.450 +03:00 INF] PoultrySlaughterPOS.MainWindow: Successfully navigated to POSSales
[2025-06-05 19:09:19.458 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Real invoice number generated and set: 202506050002
[2025-06-05 19:09:19.460 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized successfully with search and edit capabilities
[2025-06-05 19:09:19.460 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialization completed successfully
[2025-06-05 19:09:19.466 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Applying emergency TextBox visibility fix
[2025-06-05 19:09:19.472 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Emergency TextBox visibility fix applied successfully
[2025-06-05 19:09:19.473 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Applying emergency TextBox visibility fix
[2025-06-05 19:09:19.477 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Emergency TextBox visibility fix applied successfully
[2025-06-05 19:09:37.645 +03:00 INF] PoultrySlaughterPOS.MainWindow: Application closing initiated - performing comprehensive cleanup
[2025-06-05 19:09:37.645 +03:00 INF] PoultrySlaughterPOS.MainWindow: Starting comprehensive resource cleanup
[2025-06-05 19:09:37.663 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel cleanup completed successfully
[2025-06-05 19:09:37.667 +03:00 INF] PoultrySlaughterPOS.MainWindow: Resource cleanup completed successfully
[2025-06-05 19:09:37.668 +03:00 INF] PoultrySlaughterPOS.MainWindow: Application cleanup completed successfully
[2025-06-05 19:09:37.715 +03:00 INF] : === Poultry Slaughter POS Application Shutdown Initiated ===
[2025-06-05 19:09:37.721 +03:00 INF] Microsoft.Hosting.Lifetime: Application is shutting down...
[2025-06-05 19:09:37.739 +03:00 INF] : Application host stopped and disposed successfully
[2025-06-05 19:09:37.742 +03:00 INF] : === Poultry Slaughter POS Application Shutdown Completed ===
[2025-06-05 19:17:54.375 +03:00 INF] : === Poultry Slaughter POS Application Starting ===
[2025-06-05 19:17:54.435 +03:00 INF] : Startup initiated with complete customer management integration
[2025-06-05 19:17:55.013 +03:00 INF] : Database configuration - UseExplicitTransactions: true, EnableRetryOnFailure: false
[2025-06-05 19:17:55.115 +03:00 INF] : Service configuration completed successfully with 115 services registered (complete customer management integration)
[2025-06-05 19:17:55.243 +03:00 INF] Microsoft.Hosting.Lifetime: Application started. Press Ctrl+C to shut down.
[2025-06-05 19:17:55.248 +03:00 INF] Microsoft.Hosting.Lifetime: Hosting environment: Production
[2025-06-05 19:17:55.248 +03:00 INF] Microsoft.Hosting.Lifetime: Content root path: C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\bin\Debug\net8.0-windows
[2025-06-05 19:17:55.248 +03:00 INF] : Application host built and started successfully with complete customer management integration
[2025-06-05 19:17:55.418 +03:00 INF] : Database initialization started
[2025-06-05 19:17:55.422 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Starting database initialization for SQL Server...
[2025-06-05 19:17:56.646 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Verifying SQL Server instance with connection: Server=.\posserver;Database=chicken;Trusted_Connection=True;MultipleActiveResultSets=true;TrustServerCertificate=True
[2025-06-05 19:17:57.244 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Testing SQL Server connection...
[2025-06-05 19:17:57.394 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: SQL Server connection successful.
[2025-06-05 19:17:57.697 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database 'chicken' created/verified successfully.
[2025-06-05 19:17:58.335 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database schema verification completed:
[2025-06-05 19:17:58.335 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - TRUCKS: 3 records
[2025-06-05 19:17:58.335 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - CUSTOMERS: 4 records
[2025-06-05 19:17:58.335 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - TRUCK_LOADS: 6 records
[2025-06-05 19:17:58.335 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - INVOICES: 40 records
[2025-06-05 19:17:58.336 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - PAYMENTS: 8 records
[2025-06-05 19:17:58.336 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - DAILY_RECONCILIATION: 0 records
[2025-06-05 19:17:58.336 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - AUDIT_LOGS: 103 records
[2025-06-05 19:17:58.336 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database initialization completed successfully.
[2025-06-05 19:17:58.336 +03:00 INF] : Database initialization completed successfully
[2025-06-05 19:17:59.044 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:17:59.724 +03:00 WRN] Microsoft.EntityFrameworkCore.Query: The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
[2025-06-05 19:17:59.746 +03:00 INF] PoultrySlaughterPOS.MainWindow: MainWindow initialized successfully with complete customer management support
[2025-06-05 19:18:00.413 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:18:00.967 +03:00 ERR] Microsoft.EntityFrameworkCore.Query: An exception occurred while iterating over the results of a query for context type 'PoultrySlaughterPOS.Data.PoultryDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
[2025-06-05 19:18:01.226 +03:00 ERR] PoultrySlaughterPOS.Services.Repositories.CustomerRepository: Error retrieving debt summary
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetDebtSummaryAsync(CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 177
[2025-06-05 19:18:01.456 +03:00 INF] PoultrySlaughterPOS.MainWindow: MainWindow loaded successfully
[2025-06-05 19:18:01.487 +03:00 INF] : Main window created and displayed successfully
[2025-06-05 19:18:01.487 +03:00 INF] : === Poultry Slaughter POS Application Started Successfully ===
[2025-06-05 19:18:01.558 +03:00 INF] PoultrySlaughterPOS.MainWindow: Dashboard statistics loaded successfully - Trucks: 3, Customers: 4, Invoices: 1, Debt: ¤100.25
[2025-06-05 19:18:01.639 +03:00 ERR] PoultrySlaughterPOS.MainWindow: Error loading dashboard statistics
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetDebtSummaryAsync(CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 177
   at PoultrySlaughterPOS.MainWindow.LoadDashboardStatisticsAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\MainWindow.xaml.cs:line 527
[2025-06-05 19:18:01.642 +03:00 WRN] PoultrySlaughterPOS.MainWindow: Status message (Error): خطأ في تحميل إحصائيات النظام
[2025-06-05 19:18:01.644 +03:00 INF] PoultrySlaughterPOS.MainWindow: Initial dashboard loaded successfully
[2025-06-05 19:18:05.039 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:18:05.077 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized with invoice search and edit capabilities
[2025-06-05 19:18:05.077 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized with invoice search and edit capabilities
[2025-06-05 19:18:05.257 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialized successfully with search and edit capabilities
[2025-06-05 19:18:05.258 +03:00 INF] PoultrySlaughterPOS.Views.POSView: POSView ViewModel set successfully
[2025-06-05 19:18:05.258 +03:00 INF] PoultrySlaughterPOS.MainWindow: POS view created and configured successfully
[2025-06-05 19:18:05.260 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Initializing enhanced POSView with comprehensive data loading and search capabilities
[2025-06-05 19:18:05.670 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Initializing enhanced POSView with comprehensive data loading and search capabilities
[2025-06-05 19:18:05.684 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 4 active customers
[2025-06-05 19:18:05.960 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 4 active customers
[2025-06-05 19:18:06.337 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 3 active trucks
[2025-06-05 19:18:06.546 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 3 active trucks
[2025-06-05 19:18:06.549 +03:00 INF] PoultrySlaughterPOS.Repositories.InvoiceRepository: Generated optimized invoice number: 202506050002
[2025-06-05 19:18:06.684 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Real invoice number generated and set: 202506050002
[2025-06-05 19:18:06.685 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized successfully with search and edit capabilities
[2025-06-05 19:18:06.690 +03:00 INF] PoultrySlaughterPOS.Repositories.InvoiceRepository: Generated optimized invoice number: 202506050002
[2025-06-05 19:18:06.700 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialization completed successfully
[2025-06-05 19:18:06.701 +03:00 INF] PoultrySlaughterPOS.Views.POSView: POSView async initialization completed successfully
[2025-06-05 19:18:06.702 +03:00 INF] PoultrySlaughterPOS.MainWindow: Successfully navigated to POSSales
[2025-06-05 19:18:06.731 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Real invoice number generated and set: 202506050002
[2025-06-05 19:18:06.733 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized successfully with search and edit capabilities
[2025-06-05 19:18:06.733 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialization completed successfully
[2025-06-05 19:18:06.738 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Applying emergency TextBox visibility fix
[2025-06-05 19:18:06.747 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Emergency TextBox visibility fix applied successfully
[2025-06-05 19:18:06.748 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Applying emergency TextBox visibility fix
[2025-06-05 19:18:06.755 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Emergency TextBox visibility fix applied successfully
[2025-06-05 19:19:05.886 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel initialized with enhanced debt settlement capabilities and comprehensive null safety
[2025-06-05 19:19:05.887 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel initialized with enhanced debt settlement capabilities and comprehensive null safety
[2025-06-05 19:19:05.990 +03:00 INF] PoultrySlaughterPOS.Views.CustomerAccountsView: ViewModel set successfully for CustomerAccountsView
[2025-06-05 19:19:06.015 +03:00 INF] PoultrySlaughterPOS.Views.CustomerAccountsView: ViewModel set successfully for CustomerAccountsView
[2025-06-05 19:19:06.017 +03:00 INF] PoultrySlaughterPOS.MainWindow: Customer Accounts view created and configured successfully
[2025-06-05 19:19:06.025 +03:00 ERR] Microsoft.EntityFrameworkCore.Query: An exception occurred while iterating over the results of a query for context type 'PoultrySlaughterPOS.Data.PoultryDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
[2025-06-05 19:19:06.127 +03:00 ERR] PoultrySlaughterPOS.Services.Repositories.CustomerRepository: Error retrieving paged customers. Page: 1, Size: 50, Search: , Active: true
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
[2025-06-05 19:19:06.228 +03:00 ERR] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: Error loading customers paged
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
[2025-06-05 19:19:06.303 +03:00 ERR] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: Error during CustomerAccountsViewModel initialization
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.InitializeAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1021
[2025-06-05 19:19:06.308 +03:00 ERR] PoultrySlaughterPOS.Services.ErrorHandlingService: Error eec7444b in CustomerAccountsViewModel.InitializeAsync: InvalidOperationException - A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.InitializeAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1021
[2025-06-05 19:19:06.315 +03:00 ERR] Microsoft.EntityFrameworkCore.Query: An exception occurred while iterating over the results of a query for context type 'PoultrySlaughterPOS.Data.PoultryDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
[2025-06-05 19:19:06.394 +03:00 ERR] PoultrySlaughterPOS.Services.Repositories.CustomerRepository: Error counting active customers
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetActiveCustomerCountAsync(CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 641
[2025-06-05 19:19:06.489 +03:00 ERR] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: Error calculating customer statistics
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetActiveCustomerCountAsync(CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 641
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.CalculateStatisticsAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1338
[2025-06-05 19:19:07.078 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel initialized successfully with 4 customers
[2025-06-05 19:19:07.078 +03:00 INF] PoultrySlaughterPOS.Views.CustomerAccountsView: CustomerAccountsView initialization completed successfully
[2025-06-05 19:19:07.079 +03:00 INF] PoultrySlaughterPOS.MainWindow: Successfully navigated to CustomerAccounts
[2025-06-05 19:19:07.118 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel initialized successfully with 4 customers
[2025-06-05 19:19:20.386 +03:00 INF] PoultrySlaughterPOS.Views.POSView: POSView async initialization completed successfully
[2025-06-05 19:19:20.386 +03:00 INF] PoultrySlaughterPOS.MainWindow: Successfully navigated to POSSales
[2025-06-05 19:19:20.412 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel cleanup completed successfully
[2025-06-05 19:19:43.217 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loading invoice 202506050001 for editing
[2025-06-05 19:19:43.219 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loading existing invoice 40 for editing
[2025-06-05 19:19:43.396 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Successfully loaded invoice 202506050001 for editing
[2025-06-05 19:20:00.033 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Executing SaveInvoice with payment processing
[2025-06-05 19:20:00.562 +03:00 INF] PoultrySlaughterPOS.Repositories.InvoiceRepository: Successfully updated Invoice entity
[2025-06-05 19:20:00.595 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Successfully updated invoice 202506050001
[2025-06-05 19:20:05.278 +03:00 INF] PoultrySlaughterPOS.Views.POSView: POSView async initialization completed successfully
[2025-06-05 19:20:05.278 +03:00 INF] PoultrySlaughterPOS.MainWindow: Successfully navigated to POSSales
[2025-06-05 19:20:09.224 +03:00 INF] PoultrySlaughterPOS.Views.POSView: POSView async initialization completed successfully
[2025-06-05 19:20:09.224 +03:00 INF] PoultrySlaughterPOS.MainWindow: Successfully navigated to POSSales
[2025-06-05 19:20:11.809 +03:00 ERR] Microsoft.EntityFrameworkCore.Query: An exception occurred while iterating over the results of a query for context type 'PoultrySlaughterPOS.Data.PoultryDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
[2025-06-05 19:20:11.957 +03:00 ERR] PoultrySlaughterPOS.Services.Repositories.CustomerRepository: Error retrieving paged customers. Page: 1, Size: 50, Search: , Active: true
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 353
[2025-06-05 19:20:12.122 +03:00 ERR] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: Error loading customers paged
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 353
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
[2025-06-05 19:20:12.228 +03:00 ERR] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: Error during CustomerAccountsViewModel initialization
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 353
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.InitializeAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1021
[2025-06-05 19:20:12.234 +03:00 ERR] PoultrySlaughterPOS.Services.ErrorHandlingService: Error fee55912 in CustomerAccountsViewModel.InitializeAsync: InvalidOperationException - A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 353
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.InitializeAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1021
[2025-06-05 19:20:12.242 +03:00 INF] PoultrySlaughterPOS.Views.CustomerAccountsView: CustomerAccountsView initialization completed successfully
[2025-06-05 19:20:12.588 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel initialized successfully with 4 customers
[2025-06-05 19:20:12.588 +03:00 INF] PoultrySlaughterPOS.Views.CustomerAccountsView: CustomerAccountsView initialization completed successfully
[2025-06-05 19:20:12.588 +03:00 INF] PoultrySlaughterPOS.MainWindow: Successfully navigated to CustomerAccounts
[2025-06-05 19:20:38.852 +03:00 INF] PoultrySlaughterPOS.MainWindow: Application closing initiated - performing comprehensive cleanup
[2025-06-05 19:20:38.853 +03:00 INF] PoultrySlaughterPOS.MainWindow: Starting comprehensive resource cleanup
[2025-06-05 19:20:38.856 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel cleanup completed successfully
[2025-06-05 19:20:38.861 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel cleanup completed successfully
[2025-06-05 19:20:38.863 +03:00 INF] PoultrySlaughterPOS.MainWindow: Resource cleanup completed successfully
[2025-06-05 19:20:38.863 +03:00 INF] PoultrySlaughterPOS.MainWindow: Application cleanup completed successfully
[2025-06-05 19:20:38.911 +03:00 INF] : === Poultry Slaughter POS Application Shutdown Initiated ===
[2025-06-05 19:20:38.916 +03:00 INF] Microsoft.Hosting.Lifetime: Application is shutting down...
[2025-06-05 19:20:38.936 +03:00 INF] : Application host stopped and disposed successfully
[2025-06-05 19:20:38.936 +03:00 INF] : === Poultry Slaughter POS Application Shutdown Completed ===
[2025-06-05 19:20:42.609 +03:00 INF] : === Poultry Slaughter POS Application Starting ===
[2025-06-05 19:20:42.711 +03:00 INF] : Startup initiated with complete customer management integration
[2025-06-05 19:20:43.075 +03:00 INF] : Database configuration - UseExplicitTransactions: true, EnableRetryOnFailure: false
[2025-06-05 19:20:43.179 +03:00 INF] : Service configuration completed successfully with 115 services registered (complete customer management integration)
[2025-06-05 19:20:43.232 +03:00 INF] Microsoft.Hosting.Lifetime: Application started. Press Ctrl+C to shut down.
[2025-06-05 19:20:43.237 +03:00 INF] Microsoft.Hosting.Lifetime: Hosting environment: Production
[2025-06-05 19:20:43.237 +03:00 INF] Microsoft.Hosting.Lifetime: Content root path: C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\bin\Debug\net8.0-windows
[2025-06-05 19:20:43.238 +03:00 INF] : Application host built and started successfully with complete customer management integration
[2025-06-05 19:20:43.303 +03:00 INF] : Database initialization started
[2025-06-05 19:20:43.308 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Starting database initialization for SQL Server...
[2025-06-05 19:20:44.352 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Verifying SQL Server instance with connection: Server=.\posserver;Database=chicken;Trusted_Connection=True;MultipleActiveResultSets=true;TrustServerCertificate=True
[2025-06-05 19:20:44.761 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Testing SQL Server connection...
[2025-06-05 19:20:44.850 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: SQL Server connection successful.
[2025-06-05 19:20:45.052 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database 'chicken' created/verified successfully.
[2025-06-05 19:20:46.288 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database schema verification completed:
[2025-06-05 19:20:46.289 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - TRUCKS: 3 records
[2025-06-05 19:20:46.289 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - CUSTOMERS: 4 records
[2025-06-05 19:20:46.289 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - TRUCK_LOADS: 6 records
[2025-06-05 19:20:46.289 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - INVOICES: 40 records
[2025-06-05 19:20:46.289 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - PAYMENTS: 8 records
[2025-06-05 19:20:46.289 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - DAILY_RECONCILIATION: 0 records
[2025-06-05 19:20:46.289 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - AUDIT_LOGS: 104 records
[2025-06-05 19:20:46.289 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database initialization completed successfully.
[2025-06-05 19:20:46.289 +03:00 INF] : Database initialization completed successfully
[2025-06-05 19:20:46.776 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:20:47.600 +03:00 WRN] Microsoft.EntityFrameworkCore.Query: The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
[2025-06-05 19:20:47.617 +03:00 INF] PoultrySlaughterPOS.MainWindow: MainWindow initialized successfully with complete customer management support
[2025-06-05 19:20:47.891 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:20:48.516 +03:00 ERR] Microsoft.EntityFrameworkCore.Query: An exception occurred while iterating over the results of a query for context type 'PoultrySlaughterPOS.Data.PoultryDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
[2025-06-05 19:20:48.642 +03:00 ERR] PoultrySlaughterPOS.Services.Repositories.CustomerRepository: Error retrieving debt summary
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetDebtSummaryAsync(CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 177
[2025-06-05 19:20:48.769 +03:00 INF] PoultrySlaughterPOS.MainWindow: MainWindow loaded successfully
[2025-06-05 19:20:48.789 +03:00 INF] : Main window created and displayed successfully
[2025-06-05 19:20:48.789 +03:00 INF] : === Poultry Slaughter POS Application Started Successfully ===
[2025-06-05 19:20:48.800 +03:00 INF] PoultrySlaughterPOS.MainWindow: Dashboard statistics loaded successfully - Trucks: 3, Customers: 4, Invoices: 1, Debt: ¤100.25
[2025-06-05 19:20:48.879 +03:00 ERR] PoultrySlaughterPOS.MainWindow: Error loading dashboard statistics
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetDebtSummaryAsync(CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 177
   at PoultrySlaughterPOS.MainWindow.LoadDashboardStatisticsAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\MainWindow.xaml.cs:line 527
[2025-06-05 19:20:48.883 +03:00 WRN] PoultrySlaughterPOS.MainWindow: Status message (Error): خطأ في تحميل إحصائيات النظام
[2025-06-05 19:20:48.884 +03:00 INF] PoultrySlaughterPOS.MainWindow: Initial dashboard loaded successfully
[2025-06-05 19:20:50.387 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:20:50.389 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel initialized with enhanced debt settlement capabilities and comprehensive null safety
[2025-06-05 19:20:50.390 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel initialized with enhanced debt settlement capabilities and comprehensive null safety
[2025-06-05 19:20:50.537 +03:00 INF] PoultrySlaughterPOS.Views.CustomerAccountsView: ViewModel set successfully for CustomerAccountsView
[2025-06-05 19:20:50.578 +03:00 INF] PoultrySlaughterPOS.Views.CustomerAccountsView: ViewModel set successfully for CustomerAccountsView
[2025-06-05 19:20:50.580 +03:00 INF] PoultrySlaughterPOS.MainWindow: Customer Accounts view created and configured successfully
[2025-06-05 19:20:50.597 +03:00 ERR] Microsoft.EntityFrameworkCore.Query: An exception occurred while iterating over the results of a query for context type 'PoultrySlaughterPOS.Data.PoultryDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
[2025-06-05 19:20:50.597 +03:00 ERR] Microsoft.EntityFrameworkCore.Query: An exception occurred while iterating over the results of a query for context type 'PoultrySlaughterPOS.Data.PoultryDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
[2025-06-05 19:20:50.903 +03:00 ERR] PoultrySlaughterPOS.Services.Repositories.CustomerRepository: Error retrieving paged customers. Page: 1, Size: 50, Search: , Active: true
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
[2025-06-05 19:20:50.903 +03:00 ERR] PoultrySlaughterPOS.Services.Repositories.CustomerRepository: Error retrieving paged customers. Page: 1, Size: 50, Search: , Active: true
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
[2025-06-05 19:20:51.126 +03:00 ERR] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: Error loading customers paged
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
[2025-06-05 19:20:51.200 +03:00 ERR] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: Error loading customers paged
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
[2025-06-05 19:20:51.266 +03:00 ERR] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: Error during CustomerAccountsViewModel initialization
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.InitializeAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1021
[2025-06-05 19:20:51.271 +03:00 ERR] PoultrySlaughterPOS.Services.ErrorHandlingService: Error 0f7d8a04 in CustomerAccountsViewModel.InitializeAsync: InvalidOperationException - A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.InitializeAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1021
[2025-06-05 19:20:51.323 +03:00 ERR] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: Error during CustomerAccountsViewModel initialization
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.InitializeAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1021
[2025-06-05 19:20:51.329 +03:00 ERR] PoultrySlaughterPOS.Services.ErrorHandlingService: Error 71321b16 in CustomerAccountsViewModel.InitializeAsync: InvalidOperationException - A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.InitializeAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1021
[2025-06-05 19:20:52.369 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel initialized successfully with 4 customers
[2025-06-05 19:20:52.370 +03:00 INF] PoultrySlaughterPOS.Views.CustomerAccountsView: CustomerAccountsView initialization completed successfully
[2025-06-05 19:20:52.371 +03:00 INF] PoultrySlaughterPOS.MainWindow: Successfully navigated to CustomerAccounts
[2025-06-05 19:21:28.450 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: Opening edit customer dialog for customer: 4
[2025-06-05 19:21:28.460 +03:00 INF] PoultrySlaughterPOS.Views.Dialogs.AddCustomerDialog: Creating edit customer dialog for customer 4
[2025-06-05 19:21:28.464 +03:00 INF] PoultrySlaughterPOS.ViewModels.AddCustomerDialogViewModel: BULLETPROOF AddCustomerDialogViewModel initialized with enhanced validation
[2025-06-05 19:21:28.489 +03:00 INF] PoultrySlaughterPOS.Views.Dialogs.AddCustomerDialog: AddCustomerDialog initialized with enterprise-grade MVVM architecture
[2025-06-05 19:21:28.492 +03:00 INF] PoultrySlaughterPOS.Views.Dialogs.AddCustomerDialog: Displaying AddCustomerDialog modally
[2025-06-05 19:21:29.270 +03:00 ERR] Microsoft.EntityFrameworkCore.Query: An exception occurred while iterating over the results of a query for context type 'PoultrySlaughterPOS.Data.PoultryDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
[2025-06-05 19:21:29.323 +03:00 ERR] PoultrySlaughterPOS.Services.Repositories.CustomerRepository: Error retrieving customer by name ali
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomerByNameAsync(String customerName, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 44
[2025-06-05 19:21:29.326 +03:00 ERR] Microsoft.EntityFrameworkCore.Database.Connection: An error occurred using the connection to database 'chicken' on server '.\posserver'.
[2025-06-05 19:21:29.375 +03:00 WRN] PoultrySlaughterPOS.ViewModels.AddCustomerDialogViewModel: Database validation failed for customer name - continuing with basic validation
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomerByNameAsync(String customerName, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 44
   at PoultrySlaughterPOS.ViewModels.AddCustomerDialogViewModel.ValidateCustomerNameAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\AddCustomerDialogViewModel.cs:line 409
[2025-06-05 19:21:29.415 +03:00 ERR] PoultrySlaughterPOS.Services.Repositories.CustomerRepository: Error retrieving customer by phone 36363675766
System.Threading.Tasks.TaskCanceledException: A task was canceled.
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomerByPhoneAsync(String phoneNumber, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 59
[2025-06-05 19:21:34.454 +03:00 INF] PoultrySlaughterPOS.Views.Dialogs.AddCustomerDialog: AddCustomerDialog closing with DialogResult: false
[2025-06-05 19:21:34.506 +03:00 INF] PoultrySlaughterPOS.Views.Dialogs.AddCustomerDialog: AddCustomerDialog closed with result: false, Customer created: false
[2025-06-05 19:21:53.146 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized with invoice search and edit capabilities
[2025-06-05 19:21:53.146 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized with invoice search and edit capabilities
[2025-06-05 19:21:53.176 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialized successfully with search and edit capabilities
[2025-06-05 19:21:53.177 +03:00 INF] PoultrySlaughterPOS.Views.POSView: POSView ViewModel set successfully
[2025-06-05 19:21:53.177 +03:00 INF] PoultrySlaughterPOS.MainWindow: POS view created and configured successfully
[2025-06-05 19:21:53.183 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Initializing enhanced POSView with comprehensive data loading and search capabilities
[2025-06-05 19:21:53.325 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel cleanup completed successfully
[2025-06-05 19:21:53.326 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Initializing enhanced POSView with comprehensive data loading and search capabilities
[2025-06-05 19:21:53.331 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 4 active customers
[2025-06-05 19:21:53.436 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 4 active customers
[2025-06-05 19:21:53.534 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 3 active trucks
[2025-06-05 19:21:53.632 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 3 active trucks
[2025-06-05 19:21:53.655 +03:00 INF] PoultrySlaughterPOS.Repositories.InvoiceRepository: Generated optimized invoice number: 202506050002
[2025-06-05 19:21:53.799 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Real invoice number generated and set: 202506050002
[2025-06-05 19:21:53.809 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized successfully with search and edit capabilities
[2025-06-05 19:21:53.822 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialization completed successfully
[2025-06-05 19:21:53.822 +03:00 INF] PoultrySlaughterPOS.Views.POSView: POSView async initialization completed successfully
[2025-06-05 19:21:53.822 +03:00 INF] PoultrySlaughterPOS.MainWindow: Successfully navigated to POSSales
[2025-06-05 19:21:53.839 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Applying emergency TextBox visibility fix
[2025-06-05 19:21:53.848 +03:00 INF] PoultrySlaughterPOS.Repositories.InvoiceRepository: Generated optimized invoice number: 202506050002
[2025-06-05 19:21:53.849 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Emergency TextBox visibility fix applied successfully
[2025-06-05 19:21:53.850 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Real invoice number generated and set: 202506050002
[2025-06-05 19:21:53.852 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized successfully with search and edit capabilities
[2025-06-05 19:21:53.852 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialization completed successfully
[2025-06-05 19:21:53.853 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Applying emergency TextBox visibility fix
[2025-06-05 19:21:53.858 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Emergency TextBox visibility fix applied successfully
[2025-06-05 19:22:47.944 +03:00 INF] PoultrySlaughterPOS.MainWindow: Application closing initiated - performing comprehensive cleanup
[2025-06-05 19:22:47.944 +03:00 INF] PoultrySlaughterPOS.MainWindow: Starting comprehensive resource cleanup
[2025-06-05 19:22:47.952 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel cleanup completed successfully
[2025-06-05 19:22:47.952 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel cleanup completed successfully
[2025-06-05 19:22:47.956 +03:00 INF] PoultrySlaughterPOS.MainWindow: Resource cleanup completed successfully
[2025-06-05 19:22:47.956 +03:00 INF] PoultrySlaughterPOS.MainWindow: Application cleanup completed successfully
[2025-06-05 19:22:47.991 +03:00 INF] : === Poultry Slaughter POS Application Shutdown Initiated ===
[2025-06-05 19:22:47.999 +03:00 INF] Microsoft.Hosting.Lifetime: Application is shutting down...
[2025-06-05 19:22:48.014 +03:00 INF] : Application host stopped and disposed successfully
[2025-06-05 19:22:48.014 +03:00 INF] : === Poultry Slaughter POS Application Shutdown Completed ===
[2025-06-05 19:25:13.982 +03:00 INF] : === Poultry Slaughter POS Application Starting ===
[2025-06-05 19:25:14.055 +03:00 INF] : Startup initiated with complete customer management integration
[2025-06-05 19:25:14.382 +03:00 INF] : Database configuration - UseExplicitTransactions: true, EnableRetryOnFailure: false
[2025-06-05 19:25:14.450 +03:00 INF] : Service configuration completed successfully with 115 services registered (complete customer management integration)
[2025-06-05 19:25:14.518 +03:00 INF] Microsoft.Hosting.Lifetime: Application started. Press Ctrl+C to shut down.
[2025-06-05 19:25:14.523 +03:00 INF] Microsoft.Hosting.Lifetime: Hosting environment: Production
[2025-06-05 19:25:14.523 +03:00 INF] Microsoft.Hosting.Lifetime: Content root path: C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\bin\Debug\net8.0-windows
[2025-06-05 19:25:14.524 +03:00 INF] : Application host built and started successfully with complete customer management integration
[2025-06-05 19:25:14.611 +03:00 INF] : Database initialization started
[2025-06-05 19:25:14.614 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Starting database initialization for SQL Server...
[2025-06-05 19:25:16.470 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Verifying SQL Server instance with connection: Server=.\posserver;Database=chicken;Trusted_Connection=True;MultipleActiveResultSets=true;TrustServerCertificate=True
[2025-06-05 19:25:16.998 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Testing SQL Server connection...
[2025-06-05 19:25:17.101 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: SQL Server connection successful.
[2025-06-05 19:25:17.250 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database 'chicken' created/verified successfully.
[2025-06-05 19:25:17.715 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database schema verification completed:
[2025-06-05 19:25:17.715 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - TRUCKS: 3 records
[2025-06-05 19:25:17.715 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - CUSTOMERS: 4 records
[2025-06-05 19:25:17.715 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - TRUCK_LOADS: 6 records
[2025-06-05 19:25:17.715 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - INVOICES: 40 records
[2025-06-05 19:25:17.715 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - PAYMENTS: 8 records
[2025-06-05 19:25:17.715 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - DAILY_RECONCILIATION: 0 records
[2025-06-05 19:25:17.715 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: - AUDIT_LOGS: 104 records
[2025-06-05 19:25:17.716 +03:00 INF] PoultrySlaughterPOS.Services.DatabaseInitializationService: Database initialization completed successfully.
[2025-06-05 19:25:17.716 +03:00 INF] : Database initialization completed successfully
[2025-06-05 19:25:18.113 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:25:18.634 +03:00 WRN] Microsoft.EntityFrameworkCore.Query: The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
[2025-06-05 19:25:18.649 +03:00 INF] PoultrySlaughterPOS.MainWindow: MainWindow initialized successfully with complete customer management support
[2025-06-05 19:25:18.942 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:25:19.346 +03:00 ERR] Microsoft.EntityFrameworkCore.Query: An exception occurred while iterating over the results of a query for context type 'PoultrySlaughterPOS.Data.PoultryDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
[2025-06-05 19:25:19.475 +03:00 ERR] PoultrySlaughterPOS.Services.Repositories.CustomerRepository: Error retrieving debt summary
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetDebtSummaryAsync(CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 177
[2025-06-05 19:25:19.620 +03:00 INF] PoultrySlaughterPOS.MainWindow: MainWindow loaded successfully
[2025-06-05 19:25:19.644 +03:00 INF] : Main window created and displayed successfully
[2025-06-05 19:25:19.644 +03:00 INF] : === Poultry Slaughter POS Application Started Successfully ===
[2025-06-05 19:25:19.686 +03:00 INF] PoultrySlaughterPOS.MainWindow: Dashboard statistics loaded successfully - Trucks: 3, Customers: 4, Invoices: 1, Debt: ¤100.25
[2025-06-05 19:25:19.756 +03:00 ERR] PoultrySlaughterPOS.MainWindow: Error loading dashboard statistics
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetDebtSummaryAsync(CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 177
   at PoultrySlaughterPOS.MainWindow.LoadDashboardStatisticsAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\MainWindow.xaml.cs:line 527
[2025-06-05 19:25:19.760 +03:00 WRN] PoultrySlaughterPOS.MainWindow: Status message (Error): خطأ في تحميل إحصائيات النظام
[2025-06-05 19:25:19.761 +03:00 INF] PoultrySlaughterPOS.MainWindow: Initial dashboard loaded successfully
[2025-06-05 19:25:22.289 +03:00 INF] : SQL Server retry strategy disabled to support explicit transactions
[2025-06-05 19:25:22.292 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel initialized with enhanced debt settlement capabilities and comprehensive null safety
[2025-06-05 19:25:22.293 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel initialized with enhanced debt settlement capabilities and comprehensive null safety
[2025-06-05 19:25:22.430 +03:00 INF] PoultrySlaughterPOS.Views.CustomerAccountsView: ViewModel set successfully for CustomerAccountsView
[2025-06-05 19:25:22.462 +03:00 INF] PoultrySlaughterPOS.Views.CustomerAccountsView: ViewModel set successfully for CustomerAccountsView
[2025-06-05 19:25:22.464 +03:00 INF] PoultrySlaughterPOS.MainWindow: Customer Accounts view created and configured successfully
[2025-06-05 19:25:22.483 +03:00 ERR] Microsoft.EntityFrameworkCore.Query: An exception occurred while iterating over the results of a query for context type 'PoultrySlaughterPOS.Data.PoultryDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
[2025-06-05 19:25:22.483 +03:00 ERR] Microsoft.EntityFrameworkCore.Query: An exception occurred while iterating over the results of a query for context type 'PoultrySlaughterPOS.Data.PoultryDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
[2025-06-05 19:25:22.601 +03:00 ERR] PoultrySlaughterPOS.Services.Repositories.CustomerRepository: Error retrieving paged customers. Page: 1, Size: 50, Search: , Active: true
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
[2025-06-05 19:25:22.601 +03:00 ERR] PoultrySlaughterPOS.Services.Repositories.CustomerRepository: Error retrieving paged customers. Page: 1, Size: 50, Search: , Active: true
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
[2025-06-05 19:25:22.787 +03:00 ERR] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: Error loading customers paged
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
[2025-06-05 19:25:22.854 +03:00 ERR] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: Error loading customers paged
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
[2025-06-05 19:25:22.955 +03:00 ERR] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: Error during CustomerAccountsViewModel initialization
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.InitializeAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1021
[2025-06-05 19:25:22.965 +03:00 ERR] PoultrySlaughterPOS.Services.ErrorHandlingService: Error 313c88a9 in CustomerAccountsViewModel.InitializeAsync: InvalidOperationException - A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.InitializeAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1021
[2025-06-05 19:25:23.004 +03:00 ERR] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: Error during CustomerAccountsViewModel initialization
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.InitializeAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1021
[2025-06-05 19:25:23.008 +03:00 ERR] PoultrySlaughterPOS.Services.ErrorHandlingService: Error 38878aef in CustomerAccountsViewModel.InitializeAsync: InvalidOperationException - A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at PoultrySlaughterPOS.Services.Repositories.CustomerRepository.GetCustomersPagedAsync(Int32 pageNumber, Int32 pageSize, String searchTerm, Nullable`1 isActive, CancellationToken cancellationToken) in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\Services\Repositories\Implementations\CustomerRepository.cs:line 356
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.LoadCustomersPagedAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1255
   at PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel.InitializeAsync() in C:\Users\$\Desktop\PoultrySlaughterPOS\PoultrySlaughterPOS\ViewModels\CustomerAccountsViewModel.cs:line 1021
[2025-06-05 19:25:23.018 +03:00 INF] PoultrySlaughterPOS.Views.CustomerAccountsView: CustomerAccountsView initialization completed successfully
[2025-06-05 19:25:23.025 +03:00 INF] PoultrySlaughterPOS.MainWindow: Successfully navigated to CustomerAccounts
[2025-06-05 19:25:23.567 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel initialized successfully with 4 customers
[2025-06-05 19:25:30.990 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized with invoice search and edit capabilities
[2025-06-05 19:25:30.991 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized with invoice search and edit capabilities
[2025-06-05 19:25:31.040 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialized successfully with search and edit capabilities
[2025-06-05 19:25:31.041 +03:00 INF] PoultrySlaughterPOS.Views.POSView: POSView ViewModel set successfully
[2025-06-05 19:25:31.041 +03:00 INF] PoultrySlaughterPOS.MainWindow: POS view created and configured successfully
[2025-06-05 19:25:31.046 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Initializing enhanced POSView with comprehensive data loading and search capabilities
[2025-06-05 19:25:31.212 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel cleanup completed successfully
[2025-06-05 19:25:31.213 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Initializing enhanced POSView with comprehensive data loading and search capabilities
[2025-06-05 19:25:31.221 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 4 active customers
[2025-06-05 19:25:31.333 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 3 active trucks
[2025-06-05 19:25:31.443 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 4 active customers
[2025-06-05 19:25:31.451 +03:00 INF] PoultrySlaughterPOS.Repositories.InvoiceRepository: Generated optimized invoice number: 202506050002
[2025-06-05 19:25:31.554 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Real invoice number generated and set: 202506050002
[2025-06-05 19:25:31.554 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized successfully with search and edit capabilities
[2025-06-05 19:25:31.560 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialization completed successfully
[2025-06-05 19:25:31.560 +03:00 INF] PoultrySlaughterPOS.Views.POSView: POSView async initialization completed successfully
[2025-06-05 19:25:31.561 +03:00 INF] PoultrySlaughterPOS.MainWindow: Successfully navigated to POSSales
[2025-06-05 19:25:31.573 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loaded 3 active trucks
[2025-06-05 19:25:31.682 +03:00 INF] PoultrySlaughterPOS.Repositories.InvoiceRepository: Generated optimized invoice number: 202506050002
[2025-06-05 19:25:31.683 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Real invoice number generated and set: 202506050002
[2025-06-05 19:25:31.684 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel initialized successfully with search and edit capabilities
[2025-06-05 19:25:31.685 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Enhanced POSView initialization completed successfully
[2025-06-05 19:25:31.688 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Applying emergency TextBox visibility fix
[2025-06-05 19:25:31.698 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Emergency TextBox visibility fix applied successfully
[2025-06-05 19:25:31.699 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Applying emergency TextBox visibility fix
[2025-06-05 19:25:31.705 +03:00 INF] PoultrySlaughterPOS.Views.POSView: Emergency TextBox visibility fix applied successfully
[2025-06-05 19:26:19.917 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loading invoice 202506050001 for editing
[2025-06-05 19:26:19.919 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Loading existing invoice 40 for editing
[2025-06-05 19:26:20.049 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: Successfully loaded invoice 202506050001 for editing
[2025-06-05 19:29:56.314 +03:00 INF] PoultrySlaughterPOS.MainWindow: Application closing initiated - performing comprehensive cleanup
[2025-06-05 19:29:56.314 +03:00 INF] PoultrySlaughterPOS.MainWindow: Starting comprehensive resource cleanup
[2025-06-05 19:29:56.319 +03:00 INF] PoultrySlaughterPOS.ViewModels.POSViewModel: POSViewModel cleanup completed successfully
[2025-06-05 19:29:56.319 +03:00 INF] PoultrySlaughterPOS.ViewModels.CustomerAccountsViewModel: CustomerAccountsViewModel cleanup completed successfully
[2025-06-05 19:29:56.322 +03:00 INF] PoultrySlaughterPOS.MainWindow: Resource cleanup completed successfully
[2025-06-05 19:29:56.323 +03:00 INF] PoultrySlaughterPOS.MainWindow: Application cleanup completed successfully
[2025-06-05 19:29:56.363 +03:00 INF] : === Poultry Slaughter POS Application Shutdown Initiated ===
[2025-06-05 19:29:56.371 +03:00 INF] Microsoft.Hosting.Lifetime: Application is shutting down...
[2025-06-05 19:29:56.451 +03:00 INF] : Application host stopped and disposed successfully
[2025-06-05 19:29:56.452 +03:00 INF] : === Poultry Slaughter POS Application Shutdown Completed ===

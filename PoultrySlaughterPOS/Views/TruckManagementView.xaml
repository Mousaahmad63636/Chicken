<UserControl x:Class="PoultrySlaughterPOS.Views.TruckManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:fa="http://schemas.fontawesome.io/icons/"
             x:Name="TruckManagementViewControl"
             FlowDirection="RightToLeft"
             FontFamily="Segoe UI"
             Background="#F8FAFC">

    <UserControl.Resources>
        <!-- Status Indicator Style -->
        <Style x:Key="StatusIndicatorStyle" TargetType="Border">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsActive}" Value="True">
                    <Setter Property="Background" Value="#28A745"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding IsActive}" Value="False">
                    <Setter Property="Background" Value="#DC3545"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Action Button Style -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Height" Value="35"/>
            <Setter Property="MinWidth" Value="100"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="3" ShadowDepth="1" Opacity="0.1"/>
                            </Border.Effect>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.8"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Primary Button Style -->
        <Style x:Key="PrimaryButtonStyle" TargetType="Button" BasedOn="{StaticResource ActionButtonStyle}">
            <Setter Property="Background" Value="#007BFF"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#007BFF"/>
        </Style>

        <!-- Success Button Style -->
        <Style x:Key="SuccessButtonStyle" TargetType="Button" BasedOn="{StaticResource ActionButtonStyle}">
            <Setter Property="Background" Value="#28A745"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#28A745"/>
        </Style>

        <!-- Warning Button Style -->
        <Style x:Key="WarningButtonStyle" TargetType="Button" BasedOn="{StaticResource ActionButtonStyle}">
            <Setter Property="Background" Value="#FFC107"/>
            <Setter Property="Foreground" Value="#212529"/>
            <Setter Property="BorderBrush" Value="#FFC107"/>
        </Style>

        <!-- Danger Button Style -->
        <Style x:Key="DangerButtonStyle" TargetType="Button" BasedOn="{StaticResource ActionButtonStyle}">
            <Setter Property="Background" Value="#DC3545"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#DC3545"/>
        </Style>

        <!-- Secondary Button Style -->
        <Style x:Key="SecondaryButtonStyle" TargetType="Button" BasedOn="{StaticResource ActionButtonStyle}">
            <Setter Property="Background" Value="#6C757D"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#6C757D"/>
        </Style>

        <!-- Card Style -->
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#DEE2E6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="10"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.1"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Statistics Card Style -->
        <Style x:Key="StatCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#DEE2E6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="MinHeight" Value="80"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.1"/>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Border Grid.Row="0" Style="{StaticResource CardStyle}" Margin="10,10,10,5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Title and Status -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <fa:FontAwesome Icon="Truck" FontSize="24" Foreground="{Binding StatusColor}" Margin="0,0,15,0"/>
                    <StackPanel>
                        <TextBlock Text="إدارة الشاحنات والسائقين" FontSize="20" FontWeight="Bold" Foreground="#212529"/>
                        <TextBlock Text="{Binding StatusMessage}" FontSize="12" Foreground="{Binding StatusColor}" Margin="0,2,0,0"/>
                    </StackPanel>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="تحديث البيانات" 
                            Command="{Binding RefreshDataCommand}"
                            Style="{StaticResource PrimaryButtonStyle}">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <fa:FontAwesome Icon="Refresh" FontSize="12" Margin="0,0,5,0"/>
                                    <TextBlock Text="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Statistics Section -->
        <Border Grid.Row="1" Style="{StaticResource CardStyle}" Margin="10,5,10,5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Total Trucks -->
                <Border Grid.Column="0" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <fa:FontAwesome Icon="Truck" FontSize="20" Foreground="#007BFF" Margin="0,0,8,0"/>
                            <TextBlock Text="إجمالي الشاحنات" FontSize="14" FontWeight="SemiBold" Foreground="#495057"/>
                        </StackPanel>
                        <TextBlock Text="{Binding TotalTrucksCount}" FontSize="24" FontWeight="Bold" 
                                   HorizontalAlignment="Center" Foreground="#007BFF" Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Active Trucks -->
                <Border Grid.Column="1" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <fa:FontAwesome Icon="CheckCircle" FontSize="20" Foreground="#28A745" Margin="0,0,8,0"/>
                            <TextBlock Text="الشاحنات النشطة" FontSize="14" FontWeight="SemiBold" Foreground="#495057"/>
                        </StackPanel>
                        <TextBlock Text="{Binding ActiveTrucksCount}" FontSize="24" FontWeight="Bold" 
                                   HorizontalAlignment="Center" Foreground="#28A745" Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Available Trucks -->
                <Border Grid.Column="2" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <fa:FontAwesome Icon="ClockOutline" FontSize="20" Foreground="#FFC107" Margin="0,0,8,0"/>
                            <TextBlock Text="جاهزة للتحميل" FontSize="14" FontWeight="SemiBold" Foreground="#495057"/>
                        </StackPanel>
                        <TextBlock Text="{Binding AvailableTrucksCount}" FontSize="24" FontWeight="Bold" 
                                   HorizontalAlignment="Center" Foreground="#FFC107" Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>

                <!-- In Transit -->
                <Border Grid.Column="3" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <fa:FontAwesome Icon="Road" FontSize="20" Foreground="#DC3545" Margin="0,0,8,0"/>
                            <TextBlock Text="في الطريق" FontSize="14" FontWeight="SemiBold" Foreground="#495057"/>
                        </StackPanel>
                        <TextBlock Text="{Binding TrucksInTransitCount}" FontSize="24" FontWeight="Bold" 
                                   HorizontalAlignment="Center" Foreground="#DC3545" Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="2" Margin="10,5,10,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Truck Form and Filters -->
            <Border Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,5,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Truck Form Section -->
                    <StackPanel Grid.Row="0">
                        <TextBlock Text="{Binding IsEditMode, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter='تعديل الشاحنة|إضافة شاحنة جديدة'}" 
                                   FontSize="16" FontWeight="Bold" Foreground="#212529" Margin="0,0,0,15"/>

                        <!-- Truck Number -->
                        <StackPanel Margin="0,0,0,10">
                            <TextBlock Text="رقم الشاحنة *" FontWeight="SemiBold" Foreground="#495057" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding TruckNumber, UpdateSourceTrigger=PropertyChanged}"
                                     Height="35" Padding="10" FontSize="14"
                                     BorderBrush="#CED4DA" BorderThickness="1"/>
                        </StackPanel>

                        <!-- Driver Name -->
                        <StackPanel Margin="0,0,0,10">
                            <TextBlock Text="اسم السائق *" FontWeight="SemiBold" Foreground="#495057" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding DriverName, UpdateSourceTrigger=PropertyChanged}"
                                     Height="35" Padding="10" FontSize="14"
                                     BorderBrush="#CED4DA" BorderThickness="1"/>
                        </StackPanel>

                        <!-- Is Active -->
                        <StackPanel Margin="0,0,0,15" Orientation="Horizontal">
                            <CheckBox IsChecked="{Binding IsActive}" 
                                      Content="الشاحنة نشطة" 
                                      FontSize="14" FontWeight="SemiBold" 
                                      Foreground="#495057" VerticalAlignment="Center"/>
                        </StackPanel>

                        <!-- Validation Errors -->
                        <ItemsControl ItemsSource="{Binding ValidationErrors}" 
                                      x:Name="ValidationErrorsPanel"
                                      Margin="0,0,0,15">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="0,2">
                                        <fa:FontAwesome Icon="ExclamationTriangle" FontSize="12" Foreground="#DC3545" Margin="0,0,5,0"/>
                                        <TextBlock Text="{Binding}" FontSize="12" Foreground="#DC3545"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- Form Buttons -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <!-- Add/Update Button -->
                            <Button x:Name="SaveButton" Content="حفظ" 
                                    Style="{StaticResource SuccessButtonStyle}"/>

                            <!-- Cancel Button -->
                            <Button Content="إلغاء" 
                                    Command="{Binding CancelEditCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    x:Name="CancelEditButton"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Separator -->
                    <Separator Grid.Row="1" Margin="0,20" Background="#DEE2E6"/>

                    <!-- Filters Section -->
                    <StackPanel Grid.Row="2">
                        <TextBlock Text="البحث والتصفية" FontSize="16" FontWeight="Bold" Foreground="#212529" Margin="0,0,0,15"/>

                        <!-- Search Box -->
                        <StackPanel Margin="0,0,0,10">
                            <TextBlock Text="البحث" FontWeight="SemiBold" Foreground="#495057" Margin="0,0,0,5"/>
                            <Grid>
                                <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                         Height="35" Padding="35,10,10,10" FontSize="14"
                                         BorderBrush="#CED4DA" BorderThickness="1"/>
                                <fa:FontAwesome Icon="Search" FontSize="14" Foreground="#6C757D" 
                                                HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,10,0"/>
                            </Grid>
                        </StackPanel>

                        <!-- Filters -->
                        <StackPanel Margin="0,0,0,10">
                            <CheckBox IsChecked="{Binding ShowActiveOnly}" 
                                      Content="الشاحنات النشطة فقط" 
                                      FontSize="14" Margin="0,5"/>
                            <CheckBox IsChecked="{Binding ShowAvailableOnly}" 
                                      Content="الجاهزة للتحميل فقط" 
                                      FontSize="14" Margin="0,5"/>
                        </StackPanel>

                        <!-- Filter Buttons -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,15,0,0">
                            <Button Content="تطبيق" 
                                    Command="{Binding ApplyFiltersCommand}"
                                    Style="{StaticResource PrimaryButtonStyle}"/>
                            <Button Content="مسح" 
                                    Command="{Binding ClearFiltersCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}"/>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Right Panel - Trucks List and Details -->
            <Border Grid.Column="1" Style="{StaticResource CardStyle}" Margin="5,0,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Trucks List Header -->
                    <Grid Grid.Row="0" Margin="0,0,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="قائمة الشاحنات" FontSize="16" FontWeight="Bold" Foreground="#212529"/>

                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <TextBlock Text="{Binding TotalRecords, StringFormat='المجموع: {0}'}" 
                                       FontSize="12" Foreground="#6C757D" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        </StackPanel>
                    </Grid>

                    <!-- Trucks DataGrid -->
                    <DataGrid Grid.Row="1" 
                              ItemsSource="{Binding Trucks}"
                              SelectedItem="{Binding SelectedTruck}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              CanUserReorderColumns="False"
                              CanUserResizeRows="False"
                              HeadersVisibility="Column"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="#F1F3F4"
                              AlternatingRowBackground="#F8F9FA"
                              RowHeight="45"
                              FontSize="14"
                              Margin="0,0,0,15">

                        <DataGrid.Columns>
                            <!-- Status Indicator -->
                            <DataGridTemplateColumn Header="الحالة" Width="60" CanUserSort="False">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Style="{StaticResource StatusIndicatorStyle}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- Truck Number -->
                            <DataGridTextColumn Header="رقم الشاحنة" Binding="{Binding TruckNumber}" Width="120"/>

                            <!-- Driver Name -->
                            <DataGridTextColumn Header="اسم السائق" Binding="{Binding DriverName}" Width="150"/>

                            <!-- Created Date -->
                            <DataGridTextColumn Header="تاريخ الإضافة" 
                                                Binding="{Binding CreatedDate, StringFormat='{}{0:dd/MM/yyyy}'}" 
                                                Width="100"/>

                            <!-- Actions -->
                            <DataGridTemplateColumn Header="الإجراءات" Width="150" CanUserSort="False">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="تعديل" 
                                                    Command="{Binding DataContext.EditTruckCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    Style="{StaticResource WarningButtonStyle}"
                                                    Height="25" MinWidth="50" FontSize="10" Margin="2"/>
                                            <Button Content="حذف" 
                                                    Command="{Binding DataContext.DeleteTruckCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    Style="{StaticResource DangerButtonStyle}"
                                                    Height="25" MinWidth="50" FontSize="10" Margin="2"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Pagination Controls -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center">
                        <Button Content="السابق" 
                                Command="{Binding PreviousPageCommand}"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Height="30" MinWidth="70" FontSize="12"/>

                        <TextBlock Text="{Binding CurrentPage, StringFormat='صفحة {0}'}" 
                                   VerticalAlignment="Center" Margin="15,0" FontSize="12" Foreground="#6C757D"/>

                        <TextBlock Text="{Binding TotalPages, StringFormat='من {0}'}" 
                                   VerticalAlignment="Center" Margin="0,0,15,0" FontSize="12" Foreground="#6C757D"/>

                        <Button Content="التالي" 
                                Command="{Binding NextPageCommand}"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Height="30" MinWidth="70" FontSize="12"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Loading Overlay -->
        <Border Grid.RowSpan="3" 
                Background="#80000000"
                x:Name="LoadingOverlay">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <fa:FontAwesome Icon="Spinner" Spin="True" FontSize="48" Foreground="White" Margin="0,0,0,15"/>
                <TextBlock Text="جاري التحميل..." FontSize="16" Foreground="White" HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>